<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class ActiveModel::Observer - activemodel-3.2.3 Documentation</title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/active_model/observing.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link">Object
  
</nav>

    <!-- Included Modules -->
<nav id="includes-section" class="section">
  <h3 class="section-header">Included Modules</h3>

  <ul class="link-list">
  
  
    <li><span class="include">Singleton</span>
  
  
  </ul>
</nav>

    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-c-observe">::observe</a>
    
    <li><a href="#method-c-observed_class">::observed_class</a>
    
    <li><a href="#method-c-observed_classes">::observed_classes</a>
    
    <li><a href="#method-i-disabled_for-3F">#disabled_for?</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../ActiveModel.html">ActiveModel</a>
  
    <li><a href="../ActiveModel/AttributeMethods.html">ActiveModel::AttributeMethods</a>
  
    <li><a href="../ActiveModel/AttributeMethods/ClassMethods.html">ActiveModel::AttributeMethods::ClassMethods</a>
  
    <li><a href="../ActiveModel/AttributeMethods/ClassMethods/AttributeMethodMatcher.html">ActiveModel::AttributeMethods::ClassMethods::AttributeMethodMatcher</a>
  
    <li><a href="../ActiveModel/BlockValidator.html">ActiveModel::BlockValidator</a>
  
    <li><a href="../ActiveModel/Callbacks.html">ActiveModel::Callbacks</a>
  
    <li><a href="../ActiveModel/Conversion.html">ActiveModel::Conversion</a>
  
    <li><a href="../ActiveModel/Dirty.html">ActiveModel::Dirty</a>
  
    <li><a href="../ActiveModel/EachValidator.html">ActiveModel::EachValidator</a>
  
    <li><a href="../ActiveModel/Errors.html">ActiveModel::Errors</a>
  
    <li><a href="../ActiveModel/Lint.html">ActiveModel::Lint</a>
  
    <li><a href="../ActiveModel/Lint/Tests.html">ActiveModel::Lint::Tests</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity.html">ActiveModel::MassAssignmentSecurity</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/BlackList.html">ActiveModel::MassAssignmentSecurity::BlackList</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/ClassMethods.html">ActiveModel::MassAssignmentSecurity::ClassMethods</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/Error.html">ActiveModel::MassAssignmentSecurity::Error</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/LoggerSanitizer.html">ActiveModel::MassAssignmentSecurity::LoggerSanitizer</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/PermissionSet.html">ActiveModel::MassAssignmentSecurity::PermissionSet</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/Sanitizer.html">ActiveModel::MassAssignmentSecurity::Sanitizer</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/StrictSanitizer.html">ActiveModel::MassAssignmentSecurity::StrictSanitizer</a>
  
    <li><a href="../ActiveModel/MassAssignmentSecurity/WhiteList.html">ActiveModel::MassAssignmentSecurity::WhiteList</a>
  
    <li><a href="../ActiveModel/MissingAttributeError.html">ActiveModel::MissingAttributeError</a>
  
    <li><a href="../ActiveModel/Name.html">ActiveModel::Name</a>
  
    <li><a href="../ActiveModel/Naming.html">ActiveModel::Naming</a>
  
    <li><a href="../ActiveModel/Observer.html">ActiveModel::Observer</a>
  
    <li><a href="../ActiveModel/ObserverArray.html">ActiveModel::ObserverArray</a>
  
    <li><a href="../ActiveModel/Observing.html">ActiveModel::Observing</a>
  
    <li><a href="../ActiveModel/Observing/ClassMethods.html">ActiveModel::Observing::ClassMethods</a>
  
    <li><a href="../ActiveModel/SecurePassword.html">ActiveModel::SecurePassword</a>
  
    <li><a href="../ActiveModel/SecurePassword/ClassMethods.html">ActiveModel::SecurePassword::ClassMethods</a>
  
    <li><a href="../ActiveModel/SecurePassword/InstanceMethodsOnActivation.html">ActiveModel::SecurePassword::InstanceMethodsOnActivation</a>
  
    <li><a href="../ActiveModel/Serialization.html">ActiveModel::Serialization</a>
  
    <li><a href="../ActiveModel/Serializers.html">ActiveModel::Serializers</a>
  
    <li><a href="../ActiveModel/Serializers/JSON.html">ActiveModel::Serializers::JSON</a>
  
    <li><a href="../ActiveModel/Serializers/Xml.html">ActiveModel::Serializers::Xml</a>
  
    <li><a href="../ActiveModel/StrictValidationFailed.html">ActiveModel::StrictValidationFailed</a>
  
    <li><a href="../ActiveModel/Translation.html">ActiveModel::Translation</a>
  
    <li><a href="../ActiveModel/Validations.html">ActiveModel::Validations</a>
  
    <li><a href="../ActiveModel/Validations/AcceptanceValidator.html">ActiveModel::Validations::AcceptanceValidator</a>
  
    <li><a href="../ActiveModel/Validations/Callbacks.html">ActiveModel::Validations::Callbacks</a>
  
    <li><a href="../ActiveModel/Validations/Callbacks/ClassMethods.html">ActiveModel::Validations::Callbacks::ClassMethods</a>
  
    <li><a href="../ActiveModel/Validations/ClassMethods.html">ActiveModel::Validations::ClassMethods</a>
  
    <li><a href="../ActiveModel/Validations/ConfirmationValidator.html">ActiveModel::Validations::ConfirmationValidator</a>
  
    <li><a href="../ActiveModel/Validations/ExclusionValidator.html">ActiveModel::Validations::ExclusionValidator</a>
  
    <li><a href="../ActiveModel/Validations/FormatValidator.html">ActiveModel::Validations::FormatValidator</a>
  
    <li><a href="../ActiveModel/Validations/HelperMethods.html">ActiveModel::Validations::HelperMethods</a>
  
    <li><a href="../ActiveModel/Validations/InclusionValidator.html">ActiveModel::Validations::InclusionValidator</a>
  
    <li><a href="../ActiveModel/Validations/LengthValidator.html">ActiveModel::Validations::LengthValidator</a>
  
    <li><a href="../ActiveModel/Validations/NumericalityValidator.html">ActiveModel::Validations::NumericalityValidator</a>
  
    <li><a href="../ActiveModel/Validations/PresenceValidator.html">ActiveModel::Validations::PresenceValidator</a>
  
    <li><a href="../ActiveModel/Validations/WithValidator.html">ActiveModel::Validations::WithValidator</a>
  
    <li><a href="../ActiveModel/Validator.html">ActiveModel::Validator</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ActiveModel::Observer</h1>

  <div id="description" class="description">
    
<h2 id="label-Active+Model+Observers">Active Model Observers</h2>

<p><a href="Observer.html">Observer</a> classes respond to life cycle
callbacks to implement trigger-like behavior outside the original class.
This is a great way to reduce the clutter that normally comes when the
model class is burdened with functionality that doesn't pertain to the core
responsibility of the class. Example:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">CommentObserver</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveModel</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_save</span>(<span class="ruby-identifier">comment</span>)
    <span class="ruby-constant">Notifications</span>.<span class="ruby-identifier">comment</span>(<span class="ruby-string">&quot;admin@do.com&quot;</span>, <span class="ruby-string">&quot;New comment was posted&quot;</span>, <span class="ruby-identifier">comment</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This <a href="Observer.html">Observer</a> sends an email when a
Comment#save is finished.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">ContactObserver</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveModel</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_create</span>(<span class="ruby-identifier">contact</span>)
    <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span>(<span class="ruby-string">'New contact added!'</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_destroy</span>(<span class="ruby-identifier">contact</span>)
    <span class="ruby-identifier">contact</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">warn</span>(<span class="ruby-node">&quot;Contact with an id of #{contact.id} was destroyed!&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>This <a href="Observer.html">Observer</a> uses logger to log when specific
callbacks are triggered.</p>

<h2 id="label-Observing+a+class+that+can%27t+be+inferred"><a href="Observing.html">Observing</a> a class that can't be inferred</h2>

<p>Observers will by default be mapped to the class with which they share a
name. So CommentObserver will be tied to observing Comment,
ProductManagerObserver to ProductManager, and so on. If you want to name
your observer differently than the class you’re interested in observing,
you can use the <code>Observer.observe</code> class method which takes
either the concrete class (Product) or a symbol for that class (:product):</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AuditObserver</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveModel</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>
  <span class="ruby-identifier">observe</span> :<span class="ruby-identifier">account</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_update</span>(<span class="ruby-identifier">account</span>)
    <span class="ruby-constant">AuditTrail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">account</span>, <span class="ruby-string">&quot;UPDATED&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>If the audit observer needs to watch more than one kind of object, this can
be specified with multiple arguments:</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AuditObserver</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveModel</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>
  <span class="ruby-identifier">observe</span> :<span class="ruby-identifier">account</span>, :<span class="ruby-identifier">balance</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">after_update</span>(<span class="ruby-identifier">record</span>)
    <span class="ruby-constant">AuditTrail</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">record</span>, <span class="ruby-string">&quot;UPDATED&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The AuditObserver will now act on both updates to Account and Balance by
treating them both as records.</p>

<p>If you’re using an <a href="Observer.html">Observer</a> in a Rails
application with Active Record, be sure to read about the necessary
configuration in the documentation for ActiveRecord::Observer.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Start observing the declared classes and their subclasses.</p>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/active_model/observing.rb, line 218</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>
  <span class="ruby-identifier">observed_classes</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">klass</span><span class="ruby-operator">|</span> <span class="ruby-identifier">add_observer!</span>(<span class="ruby-identifier">klass</span>) }
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
      <div id="method-c-observe" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">observe</span><span
            class="method-args">(*models)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Attaches the observer to the supplied model classes.</p>
          

          
          <div class="method-source-code" id="observe-source">
            <pre><span class="ruby-comment"># File lib/active_model/observing.rb, line 187</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">observe</span>(*<span class="ruby-identifier">models</span>)
  <span class="ruby-identifier">models</span>.<span class="ruby-identifier">flatten!</span>
  <span class="ruby-identifier">models</span>.<span class="ruby-identifier">collect!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">model</span><span class="ruby-operator">|</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:to_sym</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">model</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">camelize</span>.<span class="ruby-identifier">constantize</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">model</span> }
  <span class="ruby-identifier">redefine_method</span>(<span class="ruby-value">:observed_classes</span>) { <span class="ruby-identifier">models</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- observe-source -->
          
        </div>

        

        
      </div><!-- observe-method -->

    
      <div id="method-c-observed_class" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">observed_class</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>The class observed by default is inferred from the observer’s class name:</p>

<pre>assert_equal Person, PersonObserver.observed_class</pre>
          

          
          <div class="method-source-code" id="observed_class-source">
            <pre><span class="ruby-comment"># File lib/active_model/observing.rb, line 208</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">observed_class</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">observed_class_name</span> = <span class="ruby-identifier">name</span>[<span class="ruby-regexp">%r(.*)Observer/</span>, <span class="ruby-value">1</span>]
    <span class="ruby-identifier">observed_class_name</span>.<span class="ruby-identifier">constantize</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- observed_class-source -->
          
        </div>

        

        
      </div><!-- observed_class-method -->

    
      <div id="method-c-observed_classes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">observed_classes</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Returns an array of Classes to observe.</p>

<p>You can override this instead of using the <code>observe</code> helper.</p>

<pre class="ruby"><span class="ruby-keyword">class</span> <span class="ruby-constant">AuditObserver</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ActiveModel</span><span class="ruby-operator">::</span><span class="ruby-constant">Observer</span>
  <span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">observed_classes</span>
    [<span class="ruby-constant">Account</span>, <span class="ruby-constant">Balance</span>]
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
          

          
          <div class="method-source-code" id="observed_classes-source">
            <pre><span class="ruby-comment"># File lib/active_model/observing.rb, line 202</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">observed_classes</span>
  <span class="ruby-constant">Array</span>.<span class="ruby-identifier">wrap</span>(<span class="ruby-identifier">observed_class</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- observed_classes-source -->
          
        </div>

        

        
      </div><!-- observed_classes-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-disabled_for-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">disabled_for?</span><span
            class="method-args">(object)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="disabled_for-3F-source">
            <pre><span class="ruby-comment"># File lib/active_model/observing.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">disabled_for?</span>(<span class="ruby-identifier">object</span>)
  <span class="ruby-identifier">klass</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">class</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:observers</span>)
  <span class="ruby-identifier">klass</span>.<span class="ruby-identifier">observers</span>.<span class="ruby-identifier">disabled_for?</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div><!-- disabled_for-3F-source -->
          
        </div>

        

        
      </div><!-- disabled_for-3F-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

